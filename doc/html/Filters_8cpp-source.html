<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>RTVideoFilter: projects/RTVideoFilter/Filters.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>projects/RTVideoFilter/Filters.cpp</h1><a href="Filters_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="Filters_8h.html">Filters.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="keyword">using namespace </span>std;
<a name="l00006"></a>00006 
<a name="l00007"></a><a class="code" href="classCColorFilter.html#ff9688013a5e7a70bfa9d7e188aed61f">00007</a> <span class="keywordtype">void</span> <a class="code" href="classCColorFilter.html#ff9688013a5e7a70bfa9d7e188aed61f">CColorFilter::Apply</a>(BITMAP *bmp)
<a name="l00008"></a>00008 {
<a name="l00009"></a>00009     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a>) <span class="keywordflow">return</span>;
<a name="l00010"></a>00010     <span class="keywordflow">if</span>(cr == 1.0 &amp;&amp; cg == 1.0 &amp;&amp; cb == 1.0) return ;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012     <span class="comment">//bmp_select(bmp);</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014     int32_t* i;
<a name="l00015"></a>00015 
<a name="l00016"></a>00016     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;bmp-&gt;h;y++)
<a name="l00017"></a>00017     {
<a name="l00018"></a>00018         i = ((int32_t*)bmp-&gt;line[y]);
<a name="l00019"></a>00019         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0;x&lt;bmp-&gt;w;x++)
<a name="l00020"></a>00020         {
<a name="l00021"></a>00021             p = *i;
<a name="l00022"></a>00022              *i = makecol32((<span class="keywordtype">int</span>)(cr*getr32(p)), (<span class="keywordtype">int</span>)(cg*getg32(p)), (<span class="keywordtype">int</span>)(cb*getb32(p)));
<a name="l00023"></a>00023              i++;
<a name="l00024"></a>00024         }
<a name="l00025"></a>00025     }
<a name="l00026"></a>00026 }
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="classCWaveFilter.html#ed09f9ef1f93b98a4a4d27a35e2c614d">00028</a> <span class="keywordtype">void</span> <a class="code" href="classCWaveFilter.html#ed09f9ef1f93b98a4a4d27a35e2c614d">CWaveFilter::Apply</a>(BITMAP *bmp)
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a> || height == 0 || width == 0) <span class="keywordflow">return</span>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     time_t ntime = time(NULL);
<a name="l00033"></a>00033     <span class="keywordflow">if</span>(speed == 0) offset = 0;
<a name="l00034"></a>00034     <span class="keywordflow">else</span> offset += (6.2831852 / (52.0 - speed));
<a name="l00035"></a>00035     ltime = ntime;
<a name="l00036"></a>00036     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;bmp-&gt;h;y+=2)
<a name="l00037"></a>00037     {
<a name="l00038"></a>00038         nwidth = (int)(sin((<span class="keywordtype">double</span>)y/(double)height * 6.2831852 + offset) * width);
<a name="l00039"></a>00039         blit(bmp, tmp, 0, y, 0, 0, bmp-&gt;w, 2);
<a name="l00040"></a>00040         blit(tmp, bmp, nwidth, 0, 0, y, bmp-&gt;w - nwidth, 2);
<a name="l00041"></a>00041         blit(tmp, bmp, 0, 0, bmp-&gt;w - nwidth, y, nwidth, 2);
<a name="l00042"></a>00042     }
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classCDelayFilter.html#5799831dda2adbe1f388bf9df598277e">00045</a> <span class="keywordtype">void</span> <a class="code" href="classCDelayFilter.html#5799831dda2adbe1f388bf9df598277e">CDelayFilter::Apply</a>(BITMAP *bmp)
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047     <span class="keywordtype">int</span> nindex = start_index - delay;
<a name="l00048"></a>00048     <span class="keywordflow">if</span>(nindex &lt; 0) nindex += <a class="code" href="Filters_8h.html#5b4055201d2d8170e179b1ceaa438b9c">MAX_FRAMES</a>;
<a name="l00049"></a>00049     <span class="keywordflow">if</span>(++start_index == <a class="code" href="Filters_8h.html#5b4055201d2d8170e179b1ceaa438b9c">MAX_FRAMES</a>) start_index = 0;
<a name="l00050"></a>00050     <span class="keywordflow">if</span>(size &lt; <a class="code" href="Filters_8h.html#5b4055201d2d8170e179b1ceaa438b9c">MAX_FRAMES</a>) size++;
<a name="l00051"></a>00051     blit(bmp, dbmp[start_index], 0, 0, 0, 0, vw, vh);
<a name="l00052"></a>00052 
<a name="l00053"></a>00053     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a> || delay == 0) return ;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     <span class="keywordflow">if</span>(size &gt;= delay)
<a name="l00056"></a>00056         blit(dbmp[nindex], bmp, 0, 0, 0, 0, vw, vh);
<a name="l00057"></a>00057 }
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="classCTreshFilter.html#f514ef66df548a42ccffaad4c66ec58e">00059</a> <span class="keywordtype">void</span> <a class="code" href="classCTreshFilter.html#f514ef66df548a42ccffaad4c66ec58e">CTreshFilter::Apply</a>(BITMAP *bmp)
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a>) <span class="keywordflow">return</span>;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="keywordtype">long</span> p;
<a name="l00064"></a>00064     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;bmp-&gt;h;y++)
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0;x&lt;bmp-&gt;w;x++)
<a name="l00067"></a>00067         {
<a name="l00068"></a>00068             p = _getpixel32(bmp, x, y);
<a name="l00069"></a>00069             <span class="keywordflow">if</span>(color == 0)
<a name="l00070"></a>00070             {
<a name="l00071"></a>00071                 <span class="keywordflow">if</span>(getr32(p) &lt; tresh || getg32(p) &lt; tresh || getb32(p) &lt; tresh)
<a name="l00072"></a>00072                 {
<a name="l00073"></a>00073                     _putpixel32(bmp, x, y, makecol(0, 0, 0));
<a name="l00074"></a>00074                 }
<a name="l00075"></a>00075             }<span class="keywordflow">else</span>
<a name="l00076"></a>00076             {
<a name="l00077"></a>00077                 <span class="keywordflow">if</span>(getr32(p) &gt; tresh || getg32(p) &gt; tresh || getb32(p) &gt; tresh)
<a name="l00078"></a>00078                 {
<a name="l00079"></a>00079                     _putpixel32(bmp, x, y, makecol(255, 255, 255));
<a name="l00080"></a>00080                 }
<a name="l00081"></a>00081             }
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classCBlurFilter.html#e07cb0ac117abef24a947abfb4abd68b">00086</a> <span class="keywordtype">void</span> <a class="code" href="classCBlurFilter.html#e07cb0ac117abef24a947abfb4abd68b">CBlurFilter::Apply</a>(BITMAP *bmp)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a> || blur == 0) return ;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordtype">int</span> nindex = start_index - size;
<a name="l00091"></a>00091     <span class="keywordflow">if</span>(nindex &lt; 0) nindex += <a class="code" href="Filters_8h.html#01cba768144aea5e65d9a883a77965bb">BLUR_FRAMES</a>;
<a name="l00092"></a>00092     <span class="keywordflow">if</span>(++start_index == <a class="code" href="Filters_8h.html#01cba768144aea5e65d9a883a77965bb">BLUR_FRAMES</a>) start_index = 0;
<a name="l00093"></a>00093     <span class="keywordflow">if</span>(size &lt; <a class="code" href="Filters_8h.html#01cba768144aea5e65d9a883a77965bb">BLUR_FRAMES</a>) size++;
<a name="l00094"></a>00094     blit(bmp, dbmp[start_index], 0, 0, 0, 0, vw, vh);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     nindex = start_index;
<a name="l00097"></a>00097     set_alpha_blender();
<a name="l00098"></a>00098     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;blur;i++)
<a name="l00099"></a>00099     {
<a name="l00100"></a>00100         <span class="keywordflow">if</span>(--nindex &lt; 0) nindex += <a class="code" href="Filters_8h.html#01cba768144aea5e65d9a883a77965bb">BLUR_FRAMES</a>;
<a name="l00101"></a>00101         set_trans_blender(128-i*3, 128-i*3, 128-i*3, 128-i*3);
<a name="l00102"></a>00102         draw_trans_sprite(bmp, dbmp[nindex], 0, 0);
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     solid_mode();
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="classCWeightFilter.html#0678e13e8b1934cdc1ca5ea128f2cbda">00107</a> <span class="keywordtype">void</span> <a class="code" href="classCWeightFilter.html#0678e13e8b1934cdc1ca5ea128f2cbda">CWeightFilter::Apply</a>(BITMAP *bmp)
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a> || speed == 0) return ;
<a name="l00110"></a>00110     rw = rweight;
<a name="l00111"></a>00111     gw = gweight;
<a name="l00112"></a>00112     bw = bweight;
<a name="l00113"></a>00113     sp = speed+1;
<a name="l00114"></a>00114     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;vh;y++)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116         i = ((int32_t*)bmp-&gt;line[y]);
<a name="l00117"></a>00117         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0;x&lt;vw;x++)
<a name="l00118"></a>00118         {
<a name="l00119"></a>00119             *rw = (speed*(*rw)+getr32(*i))/sp;
<a name="l00120"></a>00120             *gw = (speed*(*gw)+getg32(*i))/sp;
<a name="l00121"></a>00121             *bw = (speed*(*bw)+getb32(*i))/sp;
<a name="l00122"></a>00122             *i = makecol(*rw, *gw, *bw);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124             rw++;
<a name="l00125"></a>00125             gw++;
<a name="l00126"></a>00126             bw++;
<a name="l00127"></a>00127             i++;
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="classCGrayFilter.html#7c3d596d5ed73f51b4e51846f1df64a2">00132</a> <span class="keywordtype">void</span> <a class="code" href="classCGrayFilter.html#7c3d596d5ed73f51b4e51846f1df64a2">CGrayFilter::Apply</a>(BITMAP *bmp)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a> || perc == 0.0f) return ;
<a name="l00135"></a>00135     int32_t t;
<a name="l00136"></a>00136     int32_t *i;
<a name="l00137"></a>00137     int32_t r,g,b;
<a name="l00138"></a>00138     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;bmp-&gt;h;y++)
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         i = ((int32_t*)bmp-&gt;line[y]);
<a name="l00141"></a>00141         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0;x&lt;bmp-&gt;w;x++)
<a name="l00142"></a>00142         {
<a name="l00143"></a>00143             r = getr32(*i);
<a name="l00144"></a>00144             g = getg32(*i);
<a name="l00145"></a>00145             b = getb32(*i);
<a name="l00146"></a>00146             t = (r + g + b)/3;
<a name="l00147"></a>00147             *i = makecol(r + perc*(t - r), g + perc*(t - g), b + perc*(t - b));
<a name="l00148"></a>00148             i++;
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="classCSquareFilter.html#1cd685762d4f998ca3f92bd8391d139e">00153</a> <span class="keywordtype">void</span> <a class="code" href="classCSquareFilter.html#1cd685762d4f998ca3f92bd8391d139e">CSquareFilter::Apply</a>(BITMAP *bmp)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a> || size == 1) return ;
<a name="l00156"></a>00156     blit(bmp, tmp, 0, 0, 0, 0, bmp-&gt;w, bmp-&gt;h);
<a name="l00157"></a>00157     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;bmp-&gt;h;y+=size)
<a name="l00158"></a>00158     {
<a name="l00159"></a>00159         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0;x&lt;bmp-&gt;w;x+=size)
<a name="l00160"></a>00160         {
<a name="l00161"></a>00161             stretch_blit(tmp, bmp, x, y, 1, 1, x, y, size, size);
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="classCFadeawayFilter.html#cd42ad572263778b1140e6423b283ca4">00166</a> <span class="keywordtype">void</span> <a class="code" href="classCFadeawayFilter.html#cd42ad572263778b1140e6423b283ca4">CFadeawayFilter::Apply</a>(BITMAP *bmp)
<a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <span class="keywordflow">if</span>(!<a class="code" href="classCVideoFilter.html#d2de6d5a8fadaefd411335c9c8f7878f">active</a>) return ;
<a name="l00169"></a>00169     <span class="keywordflow">if</span>(size == 0) blit(bmp, tmp, 0, 0, 0, 0, bmp-&gt;w, bmp-&gt;h);
<a name="l00170"></a>00170     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(size &lt; time)
<a name="l00171"></a>00171     {
<a name="l00172"></a>00172         <span class="keywordtype">int</span> t = (int)(256.0f * (1.0f - (<span class="keywordtype">double</span>)size/(<span class="keywordtype">double</span>)time));
<a name="l00173"></a>00173         <span class="keywordflow">if</span>(effect == 1)
<a name="l00174"></a>00174         {
<a name="l00175"></a>00175             <span class="keywordtype">int</span> s = 10+(int)(50.0f * (<span class="keywordtype">double</span>)size/(double)time);
<a name="l00176"></a>00176             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;bmp-&gt;h;y+=s)
<a name="l00177"></a>00177                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0;x&lt;bmp-&gt;w;x+=s)
<a name="l00178"></a>00178                     stretch_blit(tmp, tmp2, x, y, 1, 1, x, y, s, s);
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180         set_alpha_blender();
<a name="l00181"></a>00181         set_trans_blender(t, t, t, t);
<a name="l00182"></a>00182         draw_trans_sprite(bmp, (effect == 1 ? tmp2 : tmp), 0, 0);
<a name="l00183"></a>00183         solid_mode();
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     <span class="keywordflow">if</span>(size &lt; time) size++;
<a name="l00186"></a>00186 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Jan 25 21:54:54 2009 for RTVideoFilter by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
